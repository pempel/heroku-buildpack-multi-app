#!/usr/bin/env bash

indent() {
    sed -u 's/^/      /'
}

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
APP_DIR=$(cat ${ENV_DIR}/APP_DIR)

cd ${BUILD_DIR}

if [ ! -d "${APP_DIR}" ]; then
    echo "APP_DIR does not exist. Aborting" | indent
    exit 1
fi

find . -maxdepth 1 -type d ! -name ${APP_DIR} ! -name "." -exec rm -rf {} +
mv ${APP_DIR}/* .
rm -rf ${APP_DIR}

echo "${BUILD_DIR}/Gemfile" > "${ENV_DIR}/BUNDLE_GEMFILE"

echo "Copied the app from the ${APP_DIR} folder successfully" | indent
